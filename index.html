<!DOCTYPE html>
<html>
<head>
  <base href="/KDSC_COLAPP/">

  <meta charset="UTF-8">
  <meta content="IE=Edge" http-equiv="X-UA-Compatible">
  <meta name="description" content="A new Flutter project.">

  <!-- iOS meta tags & icons -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="apple-mobile-web-app-title" content="colapp">
  <meta name="mobile-web-app-capable" content="yes">
  <link rel="apple-touch-icon" href="icons/Icon-192.png">

  <!-- Favicon -->
  <link rel="icon" type="image/png" href="favicon.png"/>

  <title>ColApp - Smart Receipt Scanner</title>
  <link rel="manifest" href="manifest.json">

  <!-- ColApp Download Button Styles -->
  <style>
    .colapp-download-banner {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      background: linear-gradient(45deg, #0051BA, #EC944A);
      color: white;
      padding: 15px 20px;
      text-align: center;
      z-index: 10000;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }

    .colapp-download-banner h2 {
      margin: 0 0 10px 0;
      font-size: 1.5em;
      font-weight: bold;
    }

    .colapp-download-banner p {
      margin: 0 0 15px 0;
      font-size: 1em;
      opacity: 0.9;
    }

    .colapp-download-btn {
      display: inline-block;
      background: white;
      color: #0051BA;
      padding: 12px 25px;
      border-radius: 25px;
      text-decoration: none;
      font-weight: bold;
      font-size: 16px;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(0,0,0,0.2);
      margin: 0 10px;
    }

    .colapp-download-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(0,0,0,0.3);
      color: #0051BA;
      text-decoration: none;
    }

    .colapp-close-btn {
      position: absolute;
      top: 10px;
      right: 15px;
      background: none;
      border: none;
      color: white;
      font-size: 20px;
      cursor: pointer;
      padding: 5px;
    }

    .colapp-close-btn:hover {
      opacity: 0.7;
    }

    /* Adjust body padding to account for banner */
    body {
      padding-top: 120px;
    }

    @media (max-width: 768px) {
      .colapp-download-banner {
        padding: 10px 15px;
      }
      
      .colapp-download-banner h2 {
        font-size: 1.2em;
      }
      
      .colapp-download-banner p {
        font-size: 0.9em;
      }
      
      .colapp-download-btn {
        padding: 10px 20px;
        font-size: 14px;
        margin: 5px;
      }
      
      body {
        padding-top: 140px;
      }
    }
  </style>

  <script>
    // The value below is injected by flutter build, do not touch.
    var serviceWorkerVersion = '"1638572097"';
  </script>
  <!-- This script adds the flutter initialization JS code -->
  <script src="flutter.js" defer></script>
  
  <!-- Tesseract.js for OCR on web -->
  <script src='https://unpkg.com/tesseract.js@v2.1.0/dist/tesseract.min.js'></script>
</head>
<body>
  <!-- ColApp Download Banner -->
  <div class="colapp-download-banner" id="downloadBanner">
    <button class="colapp-close-btn" onclick="closeDownloadBanner()">Ã—</button>
    <h2>ðŸ“± Download ColApp for Android</h2>
    <p>Get the full mobile experience with receipt scanning and expense tracking</p>
    <a href="ColApp.apk" class="colapp-download-btn" download>
      ðŸ“± Download APK (66.4 MB)
    </a>
    <a href="download.html" class="colapp-download-btn">
      ðŸ“‹ Learn More
    </a>
  </div>



  <script>
    // Close banner functionality
    function closeDownloadBanner() {
      const banner = document.getElementById('downloadBanner');
      banner.style.display = 'none';
      document.body.style.paddingTop = '0';
      localStorage.setItem('colapp-banner-closed', 'true');
      localStorage.setItem('colapp-banner-closed-time', Date.now().toString());
    }



    // Detect mobile devices and show banner
    function isMobile() {
      return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
    }

    // Show banner logic - more user-friendly
    function shouldShowBanner() {
      const isMobileDevice = isMobile();
      const wasClosed = localStorage.getItem('colapp-banner-closed') === 'true';
      const closedTime = localStorage.getItem('colapp-banner-closed-time');
      
      // Always show for mobile users
      if (isMobileDevice) {
        return true;
      }
      
      // For desktop users, show if:
      // 1. Never closed before, OR
      // 2. Closed more than 24 hours ago
      if (!wasClosed) {
        return true;
      }
      
      if (closedTime) {
        const closedDate = new Date(parseInt(closedTime));
        const now = new Date();
        const hoursSinceClosed = (now - closedDate) / (1000 * 60 * 60);
        
        // Show again after 24 hours
        if (hoursSinceClosed >= 24) {
          return true;
        }
      }
      
      return false;
    }

    // Apply banner visibility
    if (shouldShowBanner()) {
      document.getElementById('downloadBanner').style.display = 'block';
    } else {
      document.getElementById('downloadBanner').style.display = 'none';
      document.body.style.paddingTop = '0';
    }

    window.addEventListener('load', function(ev) {
      // Download main.dart.js
      _flutter.loader.loadEntrypoint({
        serviceWorker: {
          serviceWorkerVersion: serviceWorkerVersion,
        },
        onEntrypointLoaded: function(engineInitializer) {
          engineInitializer.initializeEngine().then(function(appRunner) {
            appRunner.runApp();
          });
        }
      });
    });
  </script>
</body>
</html>
